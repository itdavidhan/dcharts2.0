!function(){function t(t,e){var n={version:"2.0.1"};return n.default={},n.default._MARGIN={top:30,left:30,right:30,bottom:30},n.default._COLOR=t.scale.category10(),n.group={},n.group.options=function(e,r){var i={getSelector:function(){return t.select(e)},getSelWdith:function(){var t=this.getSelector();return parseFloat(t.style("width"))},getSelHeight:function(){var t=this.getSelector();return parseFloat(t.style("height"))},getWidth:function(){return r.width||this.getSelWdith()},getHeight:function(){return r.height||this.getSelHeight()},getScale:function(){return r.scale},getData:function(){return n.handle.data(r.data)},getValMax:function(){var e=-1e4;return t.map(this.getData(),function(t){var r=n.filter.maxInArrs(t)[1];r>e&&(e=r)}),e},getValMin:function(){var e=1e4;return t.map(this.getData(),function(t){var r=n.filter.minInArrs(t)[1];r<e&&(e=r)}),e},getKeyMax:function(){var e=-1e4;return t.map(this.getData(),function(t){var r=n.filter.maxInArrs(t)[0];r>e&&(e=r)}),e},getKeyMin:function(){var e=1e9;return t.map(this.getData(),function(t){var r=n.filter.minInArrs(t)[0];r<e&&(e=r)}),e},getMargin:function(){return r.margin||n.default._MARGIN},getX:function(){if("linear"==this.getScale())return t.scale.linear().domain([0,this.getKeyMax()+1]).range([0,i.quadrantWidth()]);if("time"==this.getScale())return t.time.scale().domain([new Date(2e3,0,1).getTime(),new Date(2022,0,1).getTime()]).range([0,i.quadrantWidth()]);if("ordinal"==this.getScale()){var e=this.getData()[0];return t.scale.ordinal().domain(e.map(function(t){return t[0]})).rangePoints([0,this.getWidth()-this.getMargin().left-this.getMargin().right],1)}},getY:function(){return t.scale.linear().domain([0,this.getValMax()]).range([i.quadrantHeight(),0])},getTicks:function(){return r.ticks},getInterpolate:function(){return r.interpolate||"cardinal"},getTension:function(){return r.tension||.7},showAxisX:function(){return void 0===r.showAxisX||r.showAxisX},showAxisY:function(){return void 0===r.showAxisY||r.showAxisY},showLineX:function(){return r.showLineX||!1},showLineY:function(){return r.showLineY||!1},axisTextX:function(){return r.axisTextX||""},axisTextY:function(){return r.axisTextY||""},showDot:function(){return r.showDot},showText:function(){return r.showText||!1},getColor:function(){return r.color},getFormatX:function(){return r.formatX||""},getFormatY:function(){return r.formatY||""},getPadAngle:function(){return r.padAngle||0},getTitle:function(){return r.title||""},getOuterRadius:function(){return r.outerRadius||i.getWidth()/2},getInnerRadius:function(){return void 0!==r.innerRadius?r.innerRadius:i.getOuterRadius()/2},xStart:function(){return this.getMargin().left},yStart:function(){return this.getHeight()-this.getMargin().bottom},xEnd:function(){return this.getWidth()-this.getMargin().right},yEnd:function(){return this.getMargin().top},quadrantWidth:function(){return this.getWidth()-this.getMargin().left-this.getMargin().right},quadrantHeight:function(){return this.getHeight()-this.getMargin().bottom-this.getMargin().top},_svg:null,_bodyG:null,_axesG:null,_defs:null,_bar:null,_area:null,_line:null,_dots:null,_pieG:null,_axisXb:null,_axisXt:null,_axisYl:null,_axisYr:null,_hasGuidLineX:!1,_hasGuidLineY:!1};return i},n.group.renderSvg=function(t){if(!t._svg){var e=t.getSelector();t._svg=e.html("").append("svg"),t._svg.attr("height",t.getHeight()).attr("width",t.getWidth()),n.tooltip.initTooltip(e)}},n.group.renderBody=function(t){t._bodyG||(t._bodyG=t._svg.append("g").attr("class","body").attr("transform","translate("+t.xStart()+","+t.yEnd()+")").attr("clip-path","url(#body-clip)"))},n.group.renderAxes=function(e,r){switch(e._axesG||(e._axesG=e._svg.append("g").attr("class","axes")),r){case"x-bottom":!function(){e._axisXb||(e._axisXb=t.svg.axis().scale(e.getX()).orient("bottom").tickFormat(function(t){return t+e.getFormatX()}),e._axesG.append("g").attr("class","x-axis xb").attr("transform",function(){return"translate("+e.xStart()+","+e.yStart()+")"}).call(e._axisXb).append("text").attr("x",e.xEnd()-e.xStart()).attr("dy",40).style("text-anchor","end").text(e.axisTextX()),n.group._renderGridLineX(e,"xb"))}();break;case"x-top":!function(){e._axisXt||(e._axisXt=t.svg.axis().scale(e.getX()).orient("top").tickFormat(function(t){return t+e.getFormatX()}),e._axesG.append("g").attr("class","x-axis xt").attr("transform",function(){return"translate("+e.xStart()+","+e.yEnd()+")"}).call(e._axisXt).append("text").attr("x",e.xEnd()-e.xStart()).attr("dy",-40).style("text-anchor","end").text(e.axisTextX()),n.group._renderGridLineX(e,"xt"))}();break;case"y-left":!function(){e._sxisYl||(e._sxisYl=t.svg.axis().scale(e.getY()).orient("left").ticks(e.getTicks()).tickFormat(function(t){return t+e.getFormatY()}),e._axesG.append("g").attr("class","y-axis yl").attr("transform",function(){return"translate("+e.xStart()+","+e.yEnd()+")"}).call(e._sxisYl).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",-40).style("text-anchor","end").text(e.axisTextY()),n.group._renderGridLineY(e,"yl"))}();break;case"y-right":!function(){e._axisYr||(e._axisYr=t.svg.axis().scale(e.getY()).orient("right").ticks(e.getTicks()).tickFormat(function(t){return t+e.getFormatY()}),e._axesG.append("g").attr("class","y-axis yr").attr("transform",function(){return"translate("+e.xEnd()+","+e.yEnd()+")"}).call(e._axisYr).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",40).style("text-anchor","end").text(e.axisTextY()),n.group._renderGridLineY(e,"yr"))}();break;default:console.error("参数有误")}},n.group._renderGridLineX=function(t,e){if(t.showLineX()&&!t._hasGuidLineX){var n="xb"==e?-t.quadrantHeight():t.quadrantHeight();t._axesG.selectAll("g.x-axis g.tick").append("line").classed("grid-line",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",n),t._hasGuidLineX=!0}},n.group._renderGridLineY=function(t,e){if(t.showLineY()&&!t._hasGuidLineY){var n="yl"==e?t.quadrantWidth():-t.quadrantWidth();t._axesG.selectAll("g.y-axis g.tick").append("line").classed("grid-line",!0).attr("x1",0).attr("y1",0).attr("x2",n).attr("y2",0),t._hasGuidLineY=!0}},n.group.renderLine=function(e){var r=e.getX(),i=e.getY(),a=e.getColor(),o=e.getData();e._line||(e._line=t.svg.line().x(function(t){return r(t[0])}).y(function(t){return i(t[1])}),e.getInterpolate()&&_line.interpolate(e.getInterpolate()),e.getTension()&&_line.tension(e.getTension()),e._bodyG.selectAll("path.line").data(o).enter().append("path").style("stroke",function(t,e){return void 0!==a&&a.length>0?a[e%a.length]:n.default._COLOR(e)}).attr("class","line"),e._bodyG.selectAll("path.line").data(o).transition().attr("d",function(t){return _line(t)}))},n.group.renderArea=function(e){var r=e.getX(),i=e.getY(),a=e.getColor(),o=e.getData();e._area||(e._area=t.svg.area().x(function(t){return r(t[0])}).y0(i(0)).y1(function(t){return i(t[1])}),e.getInterpolate()&&area.interpolate(e.getInterpolate()),e.getTension()&&area.tension(e.getTension()),e._bodyG.selectAll("path.area").data(o).enter().append("path").style("fill",function(t,e){return void 0!==a&&a.length>0?a[e%a.length]:n.default._COLOR(e)}).attr("class","area").attr("d",function(t){return area(t)}))},n.group.renderDots=function(e){var r=e.getX(),i=e.getY(),a=e.getColor();e.getData().forEach(function(o,s){e._dots||(e._dots=e._bodyG.selectAll("circle._"+s).data(o).enter().append("circle").attr("class","dot _"+s),e._bodyG.selectAll("circle._"+s).data(o).style("stroke",function(t){return void 0!==a&&a.length>0?a[s%a.length]:n.default._COLOR(s)}).transition().attr("cx",function(t){return r(t[0])}).attr("cy",function(t){return i(t[1])}).attr("r",4.5),dots.on("mouseenter",function(t){n.tooltip.showTooltip(t,e.getSelector())}).on("mousemove",function(){var r=t.event.pageX,i=t.event.pageY;n.tooltip.moveTooltip(e.getSelector(),r,i)}))})},n.group.renderBar=function(e,r){var i=e.getData()[0],a=e.getX(),o=e.getY(),s=e.getColor(),l=.2*Math.floor(e.quadrantWidth()/i.length);e._bar||(e._bar=e._bodyG.selectAll("rect.bar").data(i).enter().append("rect").attr("class","bar"),e._bodyG.selectAll("rect.bar").data(i).transition().style("fill",function(t,e){return void 0!==s&&s.length>0?s[e%s.length]:n.default._COLOR(e)}).attr("x",function(t){return a(t[0])-(Math.floor(e.quadrantWidth()/i.length)-l)/2}).attr("y",function(t){return o(t[1])}).attr("height",function(t){return e.yStart()-o(t[1])}).attr("width",function(t){return Math.floor(e.quadrantWidth()/i.length)-l}),e._bar.on("mouseenter.defult1",function(r){n.tooltip.showTooltip(r,e.getSelector()),t.select(this).transition().style("opacity","0.8")}).on("mousemove.defult2",function(){var r=t.event.pageX,i=t.event.pageY;n.tooltip.moveTooltip(e.getSelector(),r,i)}).on("mouseleave.defult3",function(){t.select(this).transition().style("opacity","1"),n.tooltip.hideTooltip(e.getSelector()),console.log(22)}),r&&r(e._bar),e.showText()&&function(){e._bodyG.selectAll("text.text").data(i).enter().append("text").attr("class","text").attr("x",function(t,e){return a(t instanceof Array?t[0]:e+1)}).attr("y",function(t){return o(t instanceof Array?t[1]:t)+16}).style({fill:"#FFF","font-size":"12px"}).attr("text-anchor","middle").text(function(t){return t instanceof Array?t[1]:t})}())},n.group.defineBodyClip=function(t){t._defs||(t._defs=t._svg.append("defs"),t._defs.append("clipPath").attr("id","body-clip").append("rect").attr("x",0).attr("y",0).attr("width",t.quadrantWidth()+10).attr("height",t.quadrantHeight()))},n.handle={},n.handle.data=function(t){var e=t;if(0==e.length||!(e instanceof Array))return console.error("数据为空，或者非数组"),[[]];if(e[0]instanceof Array){if(void 0!==e[0][0]){if(e[0][0]instanceof Array&&2==e[0][0].length)return e;if(e[0][0]instanceof Object){var t=[];return e.map(function(e){_a=n.utils.dfc.json2arr(e),t.push(_a)}),t}return console.error("数据格式错误"),[[]]}return 2==e[0].length?e:(console.error("数据格式错误"),[[]])}if(e[0]instanceof Object){return[n.utils.dfc.json2arr(e)]}if(Number(e[0])){var r=[];return e.map(function(t,e){var n=[e+1,t];r.push(n)}),[r]}return console.error("数据格式错误"),[[]]},n.utils={},n.utils.dfc={},n.utils.dfc.json2arr=function(t){var e=[];return t.map(function(t){var n=[];for(var r in t)n.push(t[r]);e.push(n)}),e},n.filter={},n.filter.maxInArrs=function(e){var n=[],r=[],i=0,a=0;return e.map(function(t){n.push(t[0]),r.push(t[1])}),i=t.max(n,function(t){return+t}),a=t.max(r,function(t){return+t}),[i,a]},n.filter.minInArrs=function(e){var n=[],r=[],i=0,a=0;return e.map(function(t){n.push(t[0]),r.push(t[1])}),i=t.min(n,function(t){return+t}),a=t.min(r,function(t){return+t}),[i,a]},n.barChart=function(t,e,r){function i(t){n.group.renderSvg(t),n.group.renderAxes(t,"x-bottom"),n.group.renderAxes(t,"y-left"),n.group.defineBodyClip(t),n.group.renderBody(t),n.group.renderBar(t)}i(n.group.options(t,e)),r&&r(i)},n.lineChart=function(t,e){var r=n.group.options(t,e);n.group.renderSvg(r),n.group.renderAxes(r,"x-bottom"),n.group.renderAxes(r,"y-left"),n.group.renderBody(r),n.group.renderLine(r),n.group.renderDots(r)},n.areaChart=function(t,e){var r=n.group.options(t,e);n.group.renderSvg(r),n.group.renderAxes(r,"x-bottom"),n.group.renderAxes(r,"y-left"),n.group.renderBody(r),n.group.renderLine(r),n.group.renderArea(r),n.group.renderDots(r)},n.pieChart=function(e,r){function i(r,i,a){var o=_pieG.selectAll("path.arc").data(r(s)),l=a.getColor();o.enter().append("path").attr("class","arc").attr("fill",function(t,e){return void 0!==l&&0!=l.length?l[e%l.length]:n.default._COLOR(e)}),o.transition().attrTween("d",function(e){var n=this.__current__;n||(n={startAngle:0,endAngle:0});var r=t.interpolate(n,e);return this.__current__=r(1),function(t){return i(r(t))}}),o.on("mouseenter",function(r){n.tooltip.showTooltip(r,e),t.select(this).transition().style("opacity","0.8")}).on("mousemove",function(){var r=t.event.pageX,i=t.event.pageY;n.tooltip.moveTooltip(e,r,i)}).on("mouseleave",function(){t.select(this).transition().style("opacity","1")})}function a(t,e,n){var r=_pieG.selectAll("text.label").data(t(s));r.enter().append("text").attr("class","label"),r.transition().attr("transform",function(t){return"translate("+e.centroid(t)+")"}).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.data[0]})}var o=n.group.options(e,r),e=o.getSelector(),s=o.getData()[0];e.html(""),e.on("mouseleave",function(){n.tooltip.hideTooltip(e)}),n.tooltip.initTooltip(e),n.group.renderSvg(o),n.group.renderBody(o),function(e){var n=t.layout.pie().sort(function(t){return t[0]}).value(function(t){return t[1]}),r=t.svg.arc().outerRadius(e.getOuterRadius()).innerRadius(e.getInnerRadius()).padAngle(e.getPadAngle());e._pieG||(_pieG=e._bodyG.append("g").attr("class","pie").attr("transform","translate("+e.getOuterRadius()+","+e.getOuterRadius()+")")),i(n,r,e),a(n,r,e)}(o)},n.tooltip={},n.tooltip.initTooltip=function(t){var e,t=t;e||(e=t.append("div").attr("class","tooltip").style("opacity",0))},n.tooltip.showTooltip=function(t,e){var n=function(){return t instanceof Array?t[1]:t instanceof Object?t.data[1]:t}();e.select("div.tooltip").style("opacity",.8).html(n)},n.tooltip.moveTooltip=function(t,e,n){var r=t.select("div.tooltip"),i=parseFloat(t.style("width")),a=parseFloat(t.style("height")),o=parseFloat(r.style("width"))+30,s=parseFloat(r.style("height"))+30,e=e>=i/2?e-o-20:e+20,n=n>=a/2?n-s:n;r.transition().ease("linear").style("left",e+"px").style("top",n+10+"px")},n.tooltip.hideTooltip=function(t){t.select("div.tooltip").transition().style("opacity",0)},n.flicker={timer:null,flickerBegin:function(t){var e=t,n=this;clearInterval(this.timer),this.timer=setInterval(function(){n._flicke(e)},1e3)},flickerOver:function(e){clearInterval(this.timer),t.select(e).transition().duration(600).style({"fill-opacity":1,r:4.5})},_flicke:function(e){t.select(e).transition().ease("linear").duration(600).style({"fill-opacity":0,r:80}).transition().duration(20).style({"fill-opacity":1,r:4.5})}},n.d3=t,n.crossfilter=e,n}if("function"==typeof define&&define.amd)define(["d3","crossfilter"],t);else if("object"==typeof module&&module.exports){var e=require("d3"),n=require("crossfilter2");"function"!=typeof n&&(n=n.crossfilter),module.exports=t(e,n)}else this.dcharts=t(d3,crossfilter)}();